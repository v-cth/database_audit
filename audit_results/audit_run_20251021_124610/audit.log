ğŸ“ Audit run directory: audit_results/audit_run_20251021_124610
ğŸ“ Logs will be saved to: audit_results/audit_run_20251021_124610/audit.log

======================================================================
ğŸ” Auditing table: transactions
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
âœ… Connected to BIGQUERY
ğŸ”– Table UID: bigquery-public-data.bitcoin_blockchain.transactions
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 340,311,544 rows
ğŸ”‘ Primary key from config: transaction_id
ğŸ“ Using custom query - will count rows from query result
â„¹ï¸  Custom query provided - using query as-is (no additional sampling)
ğŸ”’ Closed BIGQUERY connection
âŒ Error auditing table 'transactions': 400 POST https://bigquery.googleapis.com/bigquery/v2/projects/portfolio-402/jobs?prettyPrint=false: Table "transactions" must be qualified with a dataset (e.g. dataset.table).

Location: None
Job ID: 4f709852-200a-4c5f-a3fb-8583febf9950

Traceback (most recent call last):
  File "/Users/v/Documents/GitHub/database_audit/audit.py", line 129, in main
    results = auditor.audit_from_database(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 231, in audit_from_database
    df = db_conn.execute_query(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/database.py", line 175, in execute_query
    result = self.conn.sql(custom_query)
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/ibis/backends/sql/__init__.py", line 164, in sql
    schema = self._get_schema_using_query(query)
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/ibis/backends/bigquery/__init__.py", line 772, in _get_schema_using_query
    job = self.client.query(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/client.py", line 3573, in query
    return _job_helpers.query_jobs_insert(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/_job_helpers.py", line 204, in query_jobs_insert
    future = do_query()
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/_job_helpers.py", line 150, in do_query
    query_job._begin(retry=retry, timeout=timeout)
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/job/query.py", line 1465, in _begin
    super(QueryJob, self)._begin(client=client, retry=retry, timeout=timeout)
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/job/base.py", line 825, in _begin
    api_response = client._call_api(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/client.py", line 861, in _call_api
    return call()
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/_http/__init__.py", line 494, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 POST https://bigquery.googleapis.com/bigquery/v2/projects/portfolio-402/jobs?prettyPrint=false: Table "transactions" must be qualified with a dataset (e.g. dataset.table).

Location: None
Job ID: 4f709852-200a-4c5f-a3fb-8583febf9950


======================================================================
ğŸ” Auditing table: blocks
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
âœ… Connected to BIGQUERY
ğŸ”– Table UID: bigquery-public-data.bitcoin_blockchain.blocks
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 540,584 rows
ğŸ”‘ Primary key from config: block_id
ğŸ“ Using custom query - will count rows from query result
â„¹ï¸  Custom query provided - using query as-is (no additional sampling)
ğŸ”’ Closed BIGQUERY connection
âŒ Error auditing table 'blocks': 400 POST https://bigquery.googleapis.com/bigquery/v2/projects/portfolio-402/jobs?prettyPrint=false: Table "blocks" must be qualified with a dataset (e.g. dataset.table).

Location: None
Job ID: d34c702d-fbb6-402c-be6a-e305ef1e0f2c

Traceback (most recent call last):
  File "/Users/v/Documents/GitHub/database_audit/audit.py", line 129, in main
    results = auditor.audit_from_database(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/auditor.py", line 231, in audit_from_database
    df = db_conn.execute_query(
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/database.py", line 175, in execute_query
    result = self.conn.sql(custom_query)
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/ibis/backends/sql/__init__.py", line 164, in sql
    schema = self._get_schema_using_query(query)
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/ibis/backends/bigquery/__init__.py", line 772, in _get_schema_using_query
    job = self.client.query(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/client.py", line 3573, in query
    return _job_helpers.query_jobs_insert(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/_job_helpers.py", line 204, in query_jobs_insert
    future = do_query()
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/_job_helpers.py", line 150, in do_query
    query_job._begin(retry=retry, timeout=timeout)
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/job/query.py", line 1465, in _begin
    super(QueryJob, self)._begin(client=client, retry=retry, timeout=timeout)
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/job/base.py", line 825, in _begin
    api_response = client._call_api(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/bigquery/client.py", line 861, in _call_api
    return call()
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
  File "/Users/v/Documents/GitHub/database_audit/audit_env/lib/python3.10/site-packages/google/cloud/_http/__init__.py", line 494, in api_request
    raise exceptions.from_http_response(response)
google.api_core.exceptions.BadRequest: 400 POST https://bigquery.googleapis.com/bigquery/v2/projects/portfolio-402/jobs?prettyPrint=false: Table "blocks" must be qualified with a dataset (e.g. dataset.table).

Location: None
Job ID: d34c702d-fbb6-402c-be6a-e305ef1e0f2c


======================================================================
âœ… Audit completed! Results saved to: audit_results/audit_run_20251021_124610
â±ï¸  Total duration: 13.63 seconds
ğŸ“ Logs saved to: audit_results/audit_run_20251021_124610/audit.log
======================================================================
