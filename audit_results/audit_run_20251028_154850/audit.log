ğŸ“ Audit run directory: audit_results/audit_run_20251028_154850
ğŸ“ Logs will be saved to: audit_results/audit_run_20251028_154850/audit.log
ğŸ” Full audit mode: Running quality checks and profiling/insights

======================================================================
ğŸ’° Estimating BigQuery scan costs...
======================================================================
âœ… Connected to BIGQUERY

ğŸ” Pre-fetching metadata for 2 table(s)...
âœ… Metadata cached for all tables
   ğŸ“Š fct_avaibility_part: Estimating ALL columns (relationship detection or no filters)
   ğŸ” Estimating query: SELECT * FROM `dbt_prod.fct_avaibility_part` ORDER BY RAND() LIMIT 10000
   ğŸ“Š dim_station: Estimating ALL columns (relationship detection or no filters)
   ğŸ” Estimating query: SELECT * FROM `dbt_prod.dim_station`

ğŸ“Š Estimated bytes to scan per table:
   â€¢ fct_avaibility_part: 474.40 MB (sampled)
   â€¢ dim_station: 112.29 KB

ğŸ’¾ Total estimated data to scan: 0.47 GB (0.0005 TB)
ğŸ’µ Estimated cost (on-demand): $0.00 USD

âš ï¸  Do you want to proceed with the audit?
   Type 'y' or 'yes' to continue, or 'n' to cancel: 
âš ï¸  Running in non-interactive mode, proceeding with audit...
   (Use --yes flag in future to skip this prompt)

âœ… Proceeding with audit...

======================================================================
ğŸ” Auditing table: fct_avaibility_part
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
ğŸ”– Table UID: portfolio-402.dbt_prod.fct_avaibility_part
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 3,877,353 rows
ğŸ”¹ Partitioned by: collected_at (TIME)
ğŸ”¸ Clustered by: station_code
ğŸ“Š Loading all 13 columns
ğŸ” Sampling 10,000 rows from table using 'random' method
âœ… Loaded 10,000 rows into memory

============================================================
Auditing: fct_avaibility_part
Total rows in table: 3,877,353
Analyzing sample: 10,000 rows
============================================================


ğŸ“‹ Column Summary (All Columns):
====================================================================================================
Column Name                    Type            Status       Nulls           Distinct       
----------------------------------------------------------------------------------------------------
station_code                   Int64           âœ“ OK         0 (0.0%)        1,456          
station_name                   String          âœ— ERROR      0 (0.0%)        1,453          
capacity                       Int64           âœ“ OK         0 (0.0%)        66             
docks_available                Int64           âœ“ OK         0 (0.0%)        73             
mechanical                     Int64           âœ“ OK         0 (0.0%)        63             
ebike                          Int64           âœ“ OK         0 (0.0%)        35             
duedate                        Datetime(time_unit='ns', time_zone='UTC') âœ“ OK         0 (0.0%)        9,934          
bikes_available                Int64           âœ— ERROR      0 (0.0%)        71             
rate_bike_available            Float64         âœ“ OK         0 (0.0%)        1,041          
rate_dock_available            Float64         âœ“ OK         0 (0.0%)        1,025          
bikes_out_of_order             Int64           âœ“ OK         0 (0.0%)        39             
collected_at                   Datetime(time_unit='ns', time_zone=None) âœ“ OK         0 (0.0%)        2,620          
rounded_collected_at           Datetime(time_unit='ns', time_zone=None) âœ“ OK         0 (0.0%)        2,620          
====================================================================================================

ğŸ” Issues Found:

ğŸ“Š Column: station_name (String)
   Nulls: 0 (0.0%)
   Distinct values: 1,453
   âš ï¸  CASE DUPLICATES: 1 unique values with case variations
      'place du gÃ©nÃ©ral de gaulle' â†’ ['Place du GÃ©nÃ©ral de Gaulle', 'Place Du GÃ©nÃ©ral De Gaulle']

ğŸ“Š Column: bikes_available (Int64)
   Nulls: 0 (0.0%)
   Distinct values: 71
   âš ï¸  VALUES NOT GREATER THAN: 242 rows (2.4%)
      Expected: value > 0.0
      ğŸ’¡ Values should be > 0.0
      Examples: ['0', '0', '0', '0', '0']


â±ï¸  Audit Duration Breakdown:
   â€¢ numeric_checks: 0.008s
   â€¢ string_checks: 0.026s
   â€¢ date_checks: 0.009s
   â€¢ Total: 0.04s


â±ï¸  Table Audit Phase Breakdown:
   â€¢ Connection: 0.000s
   â€¢ Metadata: 0.007s
   â€¢ Column Selection: 0.000s
   â€¢ Data Loading: 3.608s
   â€¢ Audit Checks: 0.044s
   â€¢ Total Table Audit: 0.04s
âŒ Error auditing table 'fct_avaibility_part': unsupported format string passed to NoneType.__format__
Traceback (most recent call last):
  File "/Users/v/Documents/GitHub/database_audit/audit.py", line 395, in main
    auditor.export_results_to_html(results, str(output_file))
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/exporter_mixin.py", line 61, in export_results_to_html
    return export_to_html(results, file_path, thousand_separator, decimal_places)
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/exporters/html/export.py", line 57, in export_to_html
    {_generate_issues_section(results, has_issues)}
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/exporters/html/checks.py", line 124, in _generate_issues_section
    html += f"""
TypeError: unsupported format string passed to NoneType.__format__

======================================================================
ğŸ” Auditing table: dim_station
======================================================================
ğŸ” Secure audit mode: Direct database query via Ibis (no file export)
ğŸ”– Table UID: portfolio-402.dbt_prod.dim_station
ğŸ“‘ Table type: BASE TABLE
ğŸ“Š Table has 1,587 rows
ğŸ”‘ Primary key from config: station_code
ğŸ“Š Loading all 9 columns
âœ… Loaded 1,587 rows into memory

============================================================
Auditing: dim_station
Total rows in table: 1,587
============================================================


ğŸ”‘ Potential primary key column(s): station_code, lat

ğŸ“‹ Column Summary (All Columns):
====================================================================================================
Column Name                    Type            Status       Nulls           Distinct       
----------------------------------------------------------------------------------------------------
station_code                   Int64           âœ“ OK         0 (0.0%)        1,587          
station_name                   String          âœ— ERROR      0 (0.0%)        1,570          
capacity                       Int64           âœ— ERROR      0 (0.0%)        72             
lon                            Float64         âœ“ OK         0 (0.0%)        1,586          
lat                            Float64         âœ“ OK         0 (0.0%)        1,587          
city                           String          âœ“ OK         0 (0.0%)        68             
is_renting                     Boolean         - NOT_CHECKED 0 (0.0%)        2              
is_returning                   Boolean         - NOT_CHECKED 0 (0.0%)        2              
station_plus                   Boolean         - NOT_CHECKED 0 (0.0%)        2              
====================================================================================================

ğŸ” Issues Found:

ğŸ“Š Column: station_name (String)
   Nulls: 0 (0.0%)
   Distinct values: 1,570
   âš ï¸  CASE DUPLICATES: 1 unique values with case variations
      'place du gÃ©nÃ©ral de gaulle' â†’ ['Place du GÃ©nÃ©ral de Gaulle', 'Place Du GÃ©nÃ©ral De Gaulle']

ğŸ“Š Column: capacity (Int64)
   Nulls: 0 (0.0%)
   Distinct values: 72
   âš ï¸  VALUES NOT LESS THAN: 1,359 rows (85.6%)
      Expected: value < 20.0
      ğŸ’¡ Values should be < 20.0
      Examples: ['22 [station_code=1002]', '43 [station_code=1003]', '33 [station_code=1006]', '32 [station_code=1008]', '22 [station_code=1012]']


â±ï¸  Audit Duration Breakdown:
   â€¢ numeric_checks: 0.006s
   â€¢ string_checks: 0.018s
   â€¢ Total: 0.02s


â±ï¸  Table Audit Phase Breakdown:
   â€¢ Connection: 0.000s
   â€¢ Metadata: 0.001s
   â€¢ Column Selection: 0.000s
   â€¢ Data Loading: 2.295s
   â€¢ Audit Checks: 0.025s
   â€¢ Total Table Audit: 0.02s
âŒ Error auditing table 'dim_station': unsupported format string passed to NoneType.__format__
Traceback (most recent call last):
  File "/Users/v/Documents/GitHub/database_audit/audit.py", line 395, in main
    auditor.export_results_to_html(results, str(output_file))
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/core/exporter_mixin.py", line 61, in export_results_to_html
    return export_to_html(results, file_path, thousand_separator, decimal_places)
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/exporters/html/export.py", line 57, in export_to_html
    {_generate_issues_section(results, has_issues)}
  File "/Users/v/Documents/GitHub/database_audit/dw_auditor/exporters/html/checks.py", line 124, in _generate_issues_section
    html += f"""
TypeError: unsupported format string passed to NoneType.__format__

======================================================================
ğŸ”— Detecting table relationships...
======================================================================
   Added table: fct_avaibility_part
   Added table: dim_station

âœ… Found 3 relationships (confidence >= 70%)

Detected Relationships:
   â€¢ fct_avaibility_part.station_name â†’ dim_station.station_name
     Confidence: 97.0% | Type: many-to-one | Matching values: 1453
   â€¢ fct_avaibility_part.station_code â†’ dim_station.station_code
     Confidence: 96.7% | Type: many-to-one | Matching values: 1456
   â€¢ fct_avaibility_part.capacity â†” dim_station.capacity
     Confidence: 95.6% | Type: many-to-many | Matching values: 65

======================================================================
ğŸ“Š Generating run summary reports...
======================================================================
ğŸ“„ Summary HTML saved to: audit_results/audit_run_20251028_154850/summary.html
   â””â”€ Includes interactive relationship diagram with 3 relationship(s)
ğŸŒ Opened summary report in browser
ğŸ“„ Summary JSON saved to: audit_results/audit_run_20251028_154850/summary.json
ğŸ“„ Detailed column summary CSV saved to: audit_results/audit_run_20251028_154850/columns.csv
ğŸ“„ Table summary CSV saved to: audit_results/audit_run_20251028_154850/tables.csv
ğŸ“„ Relationships CSV saved to: audit_results/audit_run_20251028_154850/relationships.csv

======================================================================
âœ… Audit completed! Results saved to: audit_results/audit_run_20251028_154850
â±ï¸  Total duration: 24.90 seconds
ğŸ“ Logs saved to: audit_results/audit_run_20251028_154850/audit.log
======================================================================
ğŸ”’ Closed BIGQUERY connection
